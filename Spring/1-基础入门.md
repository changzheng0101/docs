# Spring

spring的核心是提供了一个容器container（也被称做Spring 应用的上下文），然后你可以创建自己的组件，这些组件被成为bean，container负责创建和管理的工作，这些组件组装起来构成最终的应用。

## 依赖注入

bean装配在一起的行为是通过依赖注入实现的。、

## 代码来配置bean

```java
@Configuration
public class ServiceConfiguration {
 @Bean
 public InventoryService inventoryService() {
 return new InventoryService();
}
 @Bean
 public ProductService productService() {
 return new ProductService(inventoryService());
 }
}
```

`@configuration`:代表这个是配置类，代表这个类可以给container中添加bean。

`@bean`代表这些是bean类，返回的对象将以bean的形式添加到Spring应用的上下文中。

## 运行程序

```java
package tacos;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
@SpringBootApplication ⇽--- Spring Boot应⽤
public class TacoCloudApplication {
 public static void main(String[] args) {
     // 创建springboot的上下文
 	SpringApplication.run(TacoCloudApplication.class, args); ⇽--- 运⾏应⽤
 }
}
```



`@SpringBootApplication`是一个组合注解，其实是三个注解的组合

* `SpringBootConfiguration`
* 
* `EnableAutoConfiguration`
* `ComponentScan`
  * 扫描哪些包

## Controller

`Controller`代表这是一个组件类，可以被SpringBoot的上下文扫描到

### 测试类的编写

对`HomeController`进行测试，测试其返回的页面，并且返回的页面中包含“welcome to ...”

```java
@RunWith(SpringRunner.class)
@WebMvcTest(HomeController.class) ⇽--- 针对HomeController的Web测试
public class HomeControllerTest {
 @Autowired
private MockMvc mockMvc; ⇽--- 注⼊MockMvc
 @Test
 public void testHomePage() throws Exception {
 mockMvc.perform(get("/")) ⇽--- 发起对“/”的GET
 .andExpect(status().isOk()) ⇽--- 期望得到HTTP 200
 .andExpect(view().name("home")) ⇽--- 期望得到home视图
 .andExpect(content().string( ⇽--- 期望包含“Welcome to...”
 containsString("Welcome to...")));
 }
}
```

## DevTools

DevTools为Spring开发⼈员提供了⼀些便利的开发期⼯具，在生产环境中会自动禁用掉对应的功能，其中包括：

*  代码变更后应⽤会⾃动重启； 
* 当⾯向浏览器的资源（如模板、JavaScript、样式表）等发⽣变化时，会⾃动 刷新浏览器；
* ⾃动禁⽤模板缓存；
*  如果使⽤H2数据库的话，内置了H2控制台。

热更新如何完成？

>在将应用程序加载到JVM的时候，会有两个独立的类加载器，一个用来加载你写的代码，一个用来加载外部通常不会改变的代码，当你对代码进行更改之后，对应的类加载器重新加载，并重启SpringBoot上下文，这样就可以减少应用的启动时间，但是当你改变外部依赖的时候，就需要自己重新手启整个应用。

